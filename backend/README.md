# Проект "Mesto: подготовка бэкенда"
https://github.com/MaxRMNK/express-mesto-gha

Коллекции запросов для Postman, которые позволяют протестировать работу серверной части приложения Mesto: https://github.com/MaxRMNK/postman_collection_mesto-api

## Описание
Проект выполнен в качестве проверочного задания в рамках учебной программы **[ЯндексПрактикум «Веб-разработчик»](https://practicum.yandex.ru/web/)**, курс 6 (спринт 8), **проектные работы #13 и #14**.

В рамках двух проектных работ написана серверная часть для [созданного ранее одностраничного сайта](https://github.com/MaxRMNK/react-mesto-auth). 
Целью этих работ является изучение на практике синтаксиса и возможностей Node, Express.js и MongoDB, получение навыков в настройке и работе с ними.

### Технологии
 - JavaScript ES6
 - Серверная среда выполнения JavaScript - Node.js v.20.11.1
 - Библиотека пакетов NPM v.10.2.4
 - Фреймворк Express.js v.4.18.2
 - MongoDB v.4.4.22 и библиотека Mongoose v.7.6.8
 - ESLint v.8.43.0 и стайлгайд Airbnb v.15.0.0

## История изменений
### Проектная работа 13. "Mesto: подготовка бэкенда"
  * Создание базовой инфраструктуры проекта
  * Создание схем и моделей двух сущностей: пользователь и карточки
  * Создание контроллеров и роутов для пользователей и карточек
  * Временное решение авторизации
  * Обработка ошибок

### Проектная работа 14. "Mesto: регистрация и авторизация на бэкенде"
  * Создание дополнительных и модернизация существующих контроллеров и роутов
  * Защитите API авторизацией и разграничение прав доступа пользователей
  * Хэширование пароля перед добавлением в БД и проверка при аутентификации
  * Настройка работы с JWT, с помощью пакета `jsonwebtoken` 
    - Получение и запись токена из/в cookies (работу localStorage тоже попробовал)
  * Реализована централизованная обработка ошибок (через собственную милдвэру)
  * Валидация полей БД с помощью библиотеки `validator` (для обеих схем: пользователь и карточки)
  * Валидация приходящих на сервер запросов с помощью мидлвэр `celebrate` и библиотеки `Joi`

## API
### Signin/Signup
  * `POST /signin` — Авторизация (email, password)
  * `POST /signup` — Регистрация (required: email, password, additional: name, about, avatar)

### Users
  * `GET /users` — Получить список всех пользователей
  * `GET /users/me` — Получить данные текущего пользователя
  * `GET /users/:ID` — Получить пользователя по ID
  * `PATCH /users/me` — Изменить данные текущего пользователя (name, about)
  * `PATCH /users/me/avatar` — Изменить аватар (avatar)

### Cards
  * `POST /cards` — Создать карточку (name, link)
  * `GET /cards` — Получить все карточки
  * `DELETE /cards/:ID` — Удалить карточку по ID
  * `PUT /cards/:ID/likes` — Поставить лайк карточке по ID
  * `DELETE /cards/:ID/likes` — Убрать лайк с карточки по ID

## Директории
  * `/routes` — Файлы роутера
  * `/controllers` — Файлы контроллеров пользователя и карточки
  * `/models` — Файлы описания Схем пользователя и карточки
  * `/middlewares` — Промежуточные миддлвэры
  * `/errors` — Классы ошибок
  * `/utils` — Вспомогательные файлы

## Разворачиваем проект локально
1. Склонировать проект, перейти в папку `/express-mesto-gha`
    ```shell
    git clone git@github.com:MaxRMNK/express-mesto-gha.git
    cd express-mesto-gha
    ```
2. Проверить версии устновленных MongoDB, Node.js и библиотеки пакетов NPM
    ```shell
    mongod -version # проверка версии MongoDB
    node -v # проверка версии Node.js
    npm -v # проверка версии NPM
    ```
3. Установить проект и его зависимости
    ```shell
    npm install
    ```

## Запуск проекта
* Запуск сервера с hot-reload (режим разработки). После запуска приложение доступно на адресе `localhost:3000`
  ```shell
  npm run dev
  ```
  `Ctrl + C` - выход из режима разработки

* Запуск сервера
  ```shell
  npm run start
  # или `node app.js`
  # или `npm start`
  ```
  `Ctrl + C` - остановка сервера

## Из чего состоит .env
  ```
  # .env
  NODE_ENV=production
  SECRET_KEY_ENV=9Y5Qnt9sgmY0tuX3d2jQTz2D0uyfKSLZ5II0p01g4fVYwazgjuZRgzqsALqewAIj
  ```

## Можно доработать
  * Вынести функции валидации из файлов `routes/` в `/middlewares/validatons.js`.
  * Тексты ошибок вынести в отдельный файл с константами.
  * Можно использовать https://www.npmjs.com/package/express-rate-limit для ограничения кол-во запросов. Для защиты от DoS-атак.
  * Можно использовать helmet для защиты приложения от некоторых широко известных веб-уязвимостей путем соответствующей настройки заголовков HTTP: https://expressjs.com/ru/advanced/best-practice-security.html.
  * Кросс-доменные запросы и механизм CORS (ПР 15).
  * Сбор логов - библиотека для логирования `winston` и мидлвэр `express-winston` (ПР 15).
  * Вынести в `.env` адрес коннекта к БД.
